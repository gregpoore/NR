mlPerf_K1C_HPRC_WGSvsRNA <- read.csv("Supporting_scripts/S07-ML-K1C-HPRC-WGSvsRNA/perfML_Human_HPRC_WGSvsRNA_ALL_22Feb24.csv",
stringsAsFactors = FALSE) %>%
select(-X) %>%
distinct() %>%
rename(AUROC=aucroc, AUPR=aupr) %>%
mutate(abbrev = abbreviationsTCGA_Allcancer[diseaseType,"abbrev"]) %>%
mutate(nullAUPR = ifelse(minorityClassName == "SolidTissueNormal",
yes=majorityClassSize/(minorityClassSize+majorityClassSize),
no=minorityClassSize/(minorityClassSize+majorityClassSize))) %>%
mutate(nullAUROC = 0.5)
# Format variable names
mlPerf_K1C_HPRC_WGSvsRNA$datasetName[mlPerf_K1C_HPRC_WGSvsRNA$datasetName == "vsnmDataGenusKrakenQCFilt_WGS"] <- "Full WGS"
mlPerf_K1C_HPRC_WGSvsRNA$datasetName[mlPerf_K1C_HPRC_WGSvsRNA$datasetName == "vsnmDataGenusKrakenQCFilt_RNA"] <- "Full RNA"
mlPerf_K1C_HPRC_WGSvsRNA$datasetName[mlPerf_K1C_HPRC_WGSvsRNA$datasetName == "vsnmDataGenusKrakenQCFiltWIS_WGS"] <- "WIS WGS"
mlPerf_K1C_HPRC_WGSvsRNA$datasetName[mlPerf_K1C_HPRC_WGSvsRNA$datasetName == "vsnmDataGenusKrakenQCFiltWIS_RNA"] <- "WIS RNA"
mlPerf_K1C_HPRC_WGSvsRNA$metadataName[mlPerf_K1C_HPRC_WGSvsRNA$metadataName == "metaDataFinalNonzeroQC_WGS"] <- "WGS"
mlPerf_K1C_HPRC_WGSvsRNA$metadataName[mlPerf_K1C_HPRC_WGSvsRNA$metadataName == "metaDataFinalNonzeroQC_RNA"] <- "RNA"
mlPerf_K1C_HPRC_WGSvsRNA$datasetName <- factor(mlPerf_K1C_HPRC_WGSvsRNA$datasetName,
levels = c("Full WGS",
"Full RNA",
"WIS WGS",
"WIS RNA"))
table(mlPerf_K1C_HPRC_WGSvsRNA$datasetName)
table(mlPerf_K1C_HPRC_WGSvsRNA$metadataName)
#----------------Full----------------#
## PT
heatmapPlot2(mlPerf_K1C_HPRC_WGSvsRNA, st="Primary Tumor",
dt="Full WGS")
heatmapPlot2(mlPerf_K1C_HPRC_WGSvsRNA, st="Primary Tumor",
dt="Full RNA")
## STN
heatmapPlot2(mlPerf_K1C_HPRC_WGSvsRNA, st="Primary Tumor vs Solid Tissue Normal",
dt="Full WGS")
heatmapPlot2(mlPerf_K1C_HPRC_WGSvsRNA, st="Primary Tumor vs Solid Tissue Normal",
dt="Full RNA")
## BDN
heatmapPlot2(st="Blood Derived Normal", dt="Full", meta="metaDataFinalNonzeroQC")
## BDN
heatmapPlot2(st="Blood Derived Normal", dt="WIS", meta="metaDataFinalNonzeroQC")
tmp <- mlPerf_K1C_HPRC_BDNStage %>%
filter(metadataName == "metaDataFinalNonzeroQCPath_BDN_EarlyStage") %>%
select(abbrev, datasetName, AUROC, AUPR)
require(tidyr)
require(pheatmap)
require(RColorBrewer)
breaksList <- seq(0, 1, length.out = 100)
abbreviationsTCGA_Allcancer <- read.csv("Input_data/tcga_abbreviations.csv",
stringsAsFactors = FALSE, row.names = 1)
## Load data
mlPerf_K1C_HPRC_BDNStage <- read.csv("Supporting_scripts/S06-ML-K1C-HPRC-Stage/perfML_Human_HPRC_BDN_EarlyStage_noMut_ALL_22Feb24.csv",
stringsAsFactors = FALSE) %>%
select(-X) %>%
distinct() %>%
rename(AUROC=aucroc, AUPR=aupr) %>%
mutate(abbrev = abbreviationsTCGA_Allcancer[diseaseType,"abbrev"]) %>%
mutate(nullAUPR = ifelse(minorityClassName == "SolidTissueNormal",
yes=majorityClassSize/(minorityClassSize+majorityClassSize),
no=minorityClassSize/(minorityClassSize+majorityClassSize))) %>%
mutate(nullAUROC = 0.5)
# Format variable names
mlPerf_K1C_HPRC_BDNStage$datasetName <- ifelse(grepl("WIS_",mlPerf_K1C_HPRC_BDNStage$datasetName),
"WIS","Full")
table(mlPerf_K1C_HPRC_BDNStage$datasetName)
table(mlPerf_K1C_HPRC_BDNStage$metadataName)
## Heatmaps
heatmapPlot3 <- function(data=mlPerf_K1C_HPRC_VSNM, st, dt,meta=NULL,fontSize=16){
if(is.null(meta)){
tmp <- data %>%
filter(sampleType == st,
datasetName == dt) %>%
select(abbrev, AUROC, AUPR) %>%
distinct(abbrev, .keep_all=TRUE) %>%
arrange(abbrev) %>%
column_to_rownames("abbrev")
} else{
tmp <- data %>%
filter(sampleType == st,
datasetName == dt,
metadataName %in% meta) %>%
select(abbrev, AUROC, AUPR) %>%
distinct(abbrev, .keep_all=TRUE) %>%
arrange(abbrev) %>%
column_to_rownames("abbrev")
}
tmp %>%
pheatmap(color = colorRampPalette(c("#0072B5FF", "white", "#BC3C29FF"))(50),
cluster_rows = FALSE,
cluster_cols = FALSE,
display_numbers = TRUE,
number_format = "%.2f",
na_col = "white",
filename = paste0("Figures/",plotPrefix,"/heatmap_",
dt,"_",st,"__",paste(meta,sep="_"),".jpeg"),
fontsize = fontSize,
number_color = "black",
width = 20,
height = 2)
tmp %>% summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR)) %>% print()
}
tmp <- mlPerf_K1C_HPRC_BDNStage %>%
filter(metadataName == "metaDataFinalNonzeroQCPath_BDN_EarlyStage") %>%
select(abbrev, datasetName, AUROC, AUPR)
head(tmp)
tmp %>% group_by(datasetName) %>% summarise(meanAUROC = mean(AUROC))
mlPerf_K1C_HPRC_BDNStage %>%
filter(metadataName == "metaDataFinalNonzeroQC_noMutGuardant") %>%
select(abbrev, datasetName, AUROC, AUPR) %>%
arrange(abbrev) %>%
group_by(datasetName) %>%
summarise(meanAUROC = mean(AUROC))
mlPerf_K1C_HPRC_BDNStage %>%
filter(metadataName == "metaDataFinalNonzeroQC_noMutFoundation") %>%
select(abbrev, datasetName, AUROC, AUPR) %>%
arrange(abbrev) %>%
group_by(datasetName) %>%
summarise(meanAUROC = mean(AUROC))
table(mlPerf_K1C_HPRC$datasetName)
table(mlPerf_K1C_HPRC$metadataName)
mlPerf_K1C_HPRC_BinsWIS <- mlPerf_K1C_HPRC %>%
filter(grepl("BinsWIS",datasetName)) %>%
mutate(metadataName = gsub("metaDataFinalNonzeroQC_HiSeq_","",metadataName))
head(mlPerf_K1C_HPRC_BinsWIS)
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
palette = c("#0072B5FF","#BC3C29FF")) +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
mlPerf_K1C_HPRC_BinsWIS <- mlPerf_K1C_HPRC %>%
filter(grepl("BinsWIS",datasetName)) %>%
mutate(metadataName = gsub("metaDataFinalNonzeroQC_HiSeq_","",metadataName)) %>%
mutate(seqCenter = metadataName)
head(mlPerf_K1C_HPRC_BinsWIS)
table(mlPerf_K1C_HPRC_BinsWIS$seqCenter)
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
palette = c("#0072B5FF","#BC3C29FF")) +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
dev.off()
dev.off()
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
ggsave(filename = paste0("Figures/",plotPrefix,"/oldVsNew_Corr_Cmp8_AUROC_21Feb24.jpeg"),
dpi = "retina", units = "in", width = 8, height = 5)
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
legend = "none",
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
ggsave(filename = paste0("Figures/",plotPrefix,"/oldVsNew_Corr_Cmp8_AUROC_21Feb24.jpeg"),
dpi = "retina", units = "in", width = 8, height = 5)
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
legend = "none",
add = "jitter",
add.params = list(alpha=0.3),
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
legend = "none",
add = "jitter",
# add.params = list(alpha=0.3),
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
mlPerf_K1C_HPRC_BinsWIS %>%
# mutate(datasetName = gsub("_HMS|_BCM|_MDA|_WashU|_Broad_WGS|_UNC|_CMS","",datasetName)) %>%
# mutate(datasetName = gsub("countsVbFinalNonzeroQC_HiSeq","Updated",datasetName)) %>%
# mutate(datasetName = gsub("vbDataBarnDFReconciledQC_HiSeq","Original",datasetName)) %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
legend = "none",
# add = "jitter",
# add.params = list(alpha=0.3),
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
ggsave(filename = paste0("Figures/",plotPrefix,"/oldVsNew_Boxplot_AUROC_23Feb24.jpeg"),
dpi = "retina", units = "in", width = 8, height = 5)
# 02-NR-Human-HPRC-reads.R
# Author: Greg Poore
# Date: Feb 20, 2024
# Purpose: Analyze TCGA human reads input into Kraken
#-------------------------------#
# Load dependencies
require(doMC)
require(plyr)
require(dplyr)
require(tibble)
require(reshape2)
require(phyloseq)
require(biomformat)
numCores <- detectCores()
registerDoMC(cores=numCores)
# Create figure folder
plotPrefix <- "K1C-HPRC"
if(!( dir.exists( file.path( paste0("Figures/",plotPrefix) )))){
dir.create(file.path( paste0("Figures/",plotPrefix) ))
}
if(!( dir.exists( file.path( paste0("Interim_data/",plotPrefix) )))){
dir.create(file.path( paste0("Interim_data/",plotPrefix) ))
}
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUPR",
fill = "datasetName",
legend = "none",
# add = "jitter",
# add.params = list(alpha=0.3),
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
warnings()
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUPR",
fill = "datasetName",
legend = "none",
# add = "jitter",
# add.params = list(alpha=0.3),
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0, 1, by = 0.1), limits = c(0,1))
ggsave(filename = paste0("Figures/",plotPrefix,"/mlPerf_BinsWIS_Boxplot_AUPR_23Feb24.jpeg"),
dpi = "retina", units = "in", width = 8, height = 5)
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUROC",
fill = "datasetName",
legend = "none",
# add = "jitter",
# add.params = list(alpha=0.3),
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0.4, 1, by = 0.1), limits = c(0.4,1))
ggsave(filename = paste0("Figures/",plotPrefix,"/mlPerf_BinsWIS_Boxplot_AUROC_23Feb24.jpeg"),
dpi = "retina", units = "in", width = 8, height = 5)
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
ggboxplot(x = "seqCenter",
y = "AUPR",
fill = "datasetName",
legend = "none",
# add = "jitter",
# add.params = list(alpha=0.3),
order = c("HMS","MDA","WashU","Broad_WGS","BCM","CMS","UNC"),
palette = "nejm") +
facet_grid( ~ sampleType, scales = "free") +
rotate_x_text(30) +
theme(text=element_text(size=15)) +
scale_y_continuous(breaks = seq(0, 1, by = 0.1), limits = c(0,1))
ggsave(filename = paste0("Figures/",plotPrefix,"/mlPerf_BinsWIS_Boxplot_AUPR_23Feb24.jpeg"),
dpi = "retina", units = "in", width = 8, height = 5)
binTumorTaxa <- read.csv("Input_data/bins-method-five-tumor-only/bin-taxonomy.tsv",
sep = "\t", stringsAsFactors = FALSE) %>%
rename("binID" = "X.input_bin",
"phylophlanString" = "X.u.k._.S.G.F.GBid.taxa_level.taxonomy.avg_dist") %>%
tidyr::separate("phylophlanString", c("sgbID","sgbHitTaxaLevel","estimated_taxonomy","avgDist"),
sep = "\\:", remove = TRUE) %>%
mutate(estimated_taxonomy = gsub("k__|p__|c__|o__|f__|g__|s__|t__","",estimated_taxonomy)) %>%
tidyr::separate("estimated_taxonomy", c("domain","phylum","class","order","family","genus","species","strain"),
sep = "\\|", remove = TRUE)
binTumorStats <- read.csv("Input_data/bins-method-five-tumor-only/bin-stats.tsv",
sep = "\t", stringsAsFactors = FALSE) %>%
rename("binID" = "X")
sum(binTumorTaxa$binID %in% binTumorStats$binID) # 759
sum(binTumorStats$binID %in% binTumorTaxa$binID) # 759
binTumorTaxaAndStats <- binTumorTaxa %>%
left_join(binTumorStats, by = "binID")
binTumorTaxaAndStatsKnown <- binTumorTaxaAndStats %>%
filter(!grepl("^GGB.+",species))
binTumorGeneraKnownUnique <- sort(unique(binTumorTaxaAndStatsKnown$genus))
length(binTumorGeneraKnownUnique) # 179
# Create new data frames of intersected dataframes
tcgaGenusKrakenAll <- countsVbFinalNonzero
colnames(tcgaGenusKrakenAll) <- gsub("k__.+\\.g__","",colnames(tcgaGenusKrakenAll))
countsVbFinalNonzeroBins <- tcgaGenusKrakenAll[, intersect(colnames(tcgaGenusKrakenAll),
binTumorGeneraKnownUnique)]
dim(countsVbFinalNonzeroBins) # 15512   132
# - No samples have zero counts after the feature subsetting
sum(rowSums(countsVbFinalNonzeroBins)==0) # 0
binWISOverlap
head(binTumorTaxaAndStats)
head(binTumorTaxaAndStatsKnown)
#--------------Stats for overlap of WIS and Bins--------------#
binTumorTaxaAndStatsKnownWIS <- binTumorTaxaAndStatsKnown %>%
filter(genus %in% binWISOverlap)
dim(binTumorTaxaAndStatsKnownWIS)
dim(binTumorTaxaAndStatsKnownWIS)
head(binTumorTaxaAndStatsKnownWIS)
binTumorTaxaAndStatsKnownWIS_Complete <- binTumorTaxaAndStatsKnownWIS %>%
filter(complete.cases(.))
head(binTumorTaxaAndStatsKnownWIS_Complete)
dim(binTumorTaxaAndStatsKnownWIS_Complete)
binTumorTaxaAndStatsKnownWIS_Complete <- binTumorTaxaAndStatsKnownWIS %>%
filter(complete.cases(.)) %>% arrange(desc(size))
head(binTumorTaxaAndStatsKnownWIS_Complete)
binTumorTaxaAndStatsKnownWIS_Complete[,c("species","completeness","contamination","N50","size")]
binTumorTaxaAndStatsKnownWIS_Complete[,c("species","completeness","contamination","N50","size")]
binTumorTaxaAndStatsKnownWIS_Complete[,c("species","completeness","contamination","N50","size")] %>%
write.csv("Outputs/binTumorTaxaAndStatsKnownWIS_Complete.csv",
row.names = FALSE)
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
group_by(seqCenter) %>%
summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR))
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
group_by(seqCenter, sampleType) %>%
summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR))
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
group_by(seqCenter, sampleType) %>%
summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR)) %>%
arrange(sampleType)
mlPerf_K1C_HPRC_BinsWIS_Stats <- mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
group_by(seqCenter, sampleType) %>%
summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR)) %>%
arrange(sampleType)
mlPerf_K1C_HPRC_BinsWIS_Stats %>%
group_by(sampleType) %>%
summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR))
mlPerf_K1C_HPRC_BinsWIS_Stats <- mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
group_by(sampleType) %>%
summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR)) %>%
arrange(sampleType)
mlPerf_K1C_HPRC_BinsWIS %>%
mutate(sampleType = gsub("Primary Tumor vs Solid Tissue Normal","Tumor vs Normal",sampleType)) %>%
select(AUROC, AUPR, abbrev,diseaseType,
sampleType,datasetName, seqCenter) %>%
mutate(sampleType = factor(sampleType, levels = c("Primary Tumor","Blood Derived Normal","Tumor vs Normal"))) %>%
group_by(sampleType) %>%
# group_by(seqCenter, sampleType) %>%
summarise(meanAUROC = mean(AUROC),
meanAUPR = mean(AUPR)) %>%
arrange(sampleType)
